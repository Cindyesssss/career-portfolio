<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºé‡‘ç›‘æ§ç³»ç»Ÿ V4 - æœ¬åœ°å¼€å‘ç‰ˆ</title>
    <style>
        :root {
            /* ä¸»å“ç‰Œè‰² - æ´»åŠ›ç´«è‰² */
            --color-primary: #8B5CF6;
            --color-primary-light: #A78BFA;
            --color-primary-lighter: #C4B5FD;
            --color-primary-dark: #7C3AED;
            --color-primary-darker: #6D28D9;
            
            /* æ¸å˜è‰²å½© */
            --gradient-primary: linear-gradient(135deg, #8B5CF6 0%, #EC4899 100%);
            --gradient-secondary: linear-gradient(135deg, #06B6D4 0%, #8B5CF6 100%);
            
            /* æ•°æ®è‰²ç³» - ç”¨äºå›¾è¡¨ */
            --color-data-1: #8B5CF6;  /* ç´«è‰² */
            --color-data-2: #06B6D4;  /* é’è‰² */
            --color-data-3: #10B981;  /* ç»¿è‰² */
            --color-data-4: #F59E0B;  /* ç¥ç€è‰² */
            --color-data-5: #EC4899;  /* ç²‰è‰² */
            
            /* åŠŸèƒ½è‰² */
            --color-success: #10B981;
            --color-success-light: #D1FAE5;
            --color-success-dark: #065F46;
            --color-error: #EF4444;
            --color-error-light: #FEE2E2;
            --color-error-dark: #991B1B;
            --color-warning: #F59E0B;
            --color-warning-light: #FEF3C7;
            --color-warning-dark: #92400E;
            --color-info: #06B6D4;
            --color-info-light: #CFFAFE;
            --color-info-dark: #0E7490;
            
            /* ä¸­æ€§è‰² */
            --color-text-primary: #000000;
            --color-text-secondary: #434343;
            --color-text-tertiary: #595959;
            --color-text-quaternary: #8C8C8C;
            --color-text-disabled: #BFBFBF;
            --color-border: #D9D9D9;
            --color-border-light: #F0F0F0;
            --color-bg-primary: #F5F5F5;
            --color-bg-secondary: #FFFFFF;
            --color-bg-tertiary: #FAFAFA;
            
            /* å­—ä½“ç³»ç»Ÿ - ç°ä»£åœ†æ¶¦ */
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 
                            'Segoe UI', 'PingFang SC', 'Hiragino Sans GB',
                            'Microsoft YaHei', sans-serif;
            --font-mono: 'SF Mono', 'Monaco', 'Cascadia Code', 
                         'Roboto Mono', 'Consolas', monospace;
            --font-accent: 'SF Pro Rounded', 'Avenir Next Rounded', 
                           'Circular', sans-serif;
            
            /* å­—ä½“å¤§å°ä¸å±‚çº§ */
            --text-xs: 0.75rem;      /* 12px - è¾…åŠ©ä¿¡æ¯/å›¾ä¾‹/æ ‡ç­¾ */
            --text-sm: 0.875rem;     /* 14px - æ­£æ–‡/ç»¼åˆåˆ†æ */
            --text-base: 1rem;       /* 16px - å…³é”®æ•°æ®ï¼ˆæ—¥æ¶¨è·Œå¹…ï¼‰ */
            --text-lg: 1.125rem;     /* 18px - åŸºé‡‘åç§° */
            --text-xl: 1.25rem;      /* 20px - å…³é”®æ•°æ®ï¼ˆå‡€å€¼ï¼‰ */
            --text-2xl: 1.5rem;      /* 24px */
            --text-3xl: 1.875rem;    /* 30px */
            --text-4xl: 2.25rem;     /* 36px */
            --text-hero: 3rem;       /* 48px */
            
            /* é—´è· */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --space-8: 32px;
            --space-10: 40px;
            --space-12: 48px;
            --space-16: 64px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: var(--font-primary);
            background: var(--gradient-primary);
            min-height: 100vh;
            color: var(--color-text-primary);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1600px; /* å¢åŠ æœ€å¤§å®½åº¦ */
            margin: 0 auto;
            padding: var(--space-6);
        }
        
        /* å¤´éƒ¨åŒºåŸŸ */
        .header {
            text-align: center;
            margin-bottom: var(--space-12);
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }
        
        .header-content {
            position: relative;
            z-index: 1;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: var(--space-12);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: var(--text-hero);
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--space-4);
            animation: chartRise 0.8s ease-out;
        }
        
        .header p {
            font-size: var(--text-xl);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-8);
            animation: fadeInUp 0.8s ease-out 0.2s both;
        }
        
        .local-dev-notice {
            background: rgba(16, 185, 129, 0.1);
            color: var(--color-success);
            padding: var(--space-4);
            border-radius: 12px;
            margin-bottom: var(--space-6);
            border-left: 4px solid var(--color-success);
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--space-6);
            margin-bottom: var(--space-12);
        }
        
        .stat-card {
            background: var(--color-bg-secondary);
            border-radius: 20px;
            padding: var(--space-8);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
            border: 1px solid var(--color-border-light);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 16px 48px rgba(0, 0, 0, 0.12);
        }
        
        .stat-card:hover::before {
            opacity: 1;
        }
        
        .stat-value {
            font-size: var(--text-4xl);
            font-weight: 700;
            color: var(--color-primary);
            margin-bottom: 8px;
            animation: countUp 1s ease-out;
        }
        
        .stat-label {
            font-size: var(--text-lg);
            color: var(--color-text-secondary);
            font-weight: 500;
        }
        
        .stat-description {
            font-size: var(--text-sm);
            color: var(--color-text-tertiary);
            margin-top: var(--space-2);
        }
        
        /* ç­›é€‰å™¨ */
        .filter-section {
            background: var(--color-bg-secondary);
            border-radius: 20px;
            padding: var(--space-6);
            margin-bottom: var(--space-8);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }
        
        .filter-tabs {
            display: flex;
            background: var(--color-bg-tertiary);
            border-radius: 16px;
            padding: var(--space-1);
            gap: var(--space-1);
            margin-bottom: var(--space-6);
        }
        
        .filter-tab {
            padding: var(--space-3) var(--space-6);
            border-radius: 12px;
            border: none;
            background: transparent;
            color: var(--color-text-secondary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            text-align: center;
            font-size: var(--text-sm);
        }
        
        .filter-tab.active {
            background: var(--color-bg-secondary);
            color: var(--color-primary);
            box-shadow: 0 4px 16px rgba(139, 92, 246, 0.2);
        }
        
        .filter-tab:hover:not(.active) {
            background: rgba(139, 92, 246, 0.1);
            color: var(--color-primary);
        }
        
        /* åŸºé‡‘åˆ—è¡¨ */
        .fund-list {
            background: var(--color-bg-secondary);
            border-radius: 20px;
            padding: 20px; /* å‡å°‘å†…è¾¹è·ï¼Œç»™å¡ç‰‡æ›´å¤šç©ºé—´ */
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        }
        
        .fund-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* å¼ºåˆ¶ä¸‰åˆ—å¸ƒå±€ */
            gap: 12px; /* å‡å°‘å¡ç‰‡é—´è·é€‚åº”ä¸‰åˆ— */
            justify-items: stretch; /* è®©å¡ç‰‡å‡åŒ€å¡«å……å¯ç”¨ç©ºé—´ */
            align-items: start; /* é¡¶éƒ¨å¯¹é½ */
            padding: 0 8px; /* æ·»åŠ å·¦å³å†…è¾¹è· */
        }
        
        /* ä¸‰åˆ—å¸ƒå±€ä¸‹çš„æ ‡é¢˜ä¼˜åŒ– - å…è®¸æ¢è¡Œæ˜¾ç¤º */
        .fund-grid .fund-name {
            /* ç§»é™¤æœ€å¤§å®½åº¦é™åˆ¶ï¼Œå…è®¸æ ‡é¢˜å®Œæ•´æ˜¾ç¤ºå¹¶æ¢è¡Œ */
        }
        
        .fund-card {
            background: var(--color-bg-secondary);
            border-radius: 20px; /* æ›´åœ†æ¶¦çš„è¾¹è§’ */
            padding: 20px; /* å‡å°‘å†…è¾¹è·é€‚åº”ä¸‰åˆ—å¸ƒå±€ */
            box-shadow: 0 8px 32px rgba(139, 92, 246, 0.12); /* ç´«è‰²é˜´å½± */
            border: 1px solid rgba(139, 92, 246, 0.1); /* æ·¡ç´«è‰²è¾¹æ¡† */
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            width: 100%;
            height: auto;
            max-width: none; /* ç§»é™¤æœ€å¤§å®½åº¦é™åˆ¶ï¼Œè®©å¡ç‰‡å……åˆ†åˆ©ç”¨ç©ºé—´ */
            min-width: 0; /* é˜²æ­¢å†…å®¹æº¢å‡º */
        }
        
        .fund-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .fund-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.2);
        }
        
        .fund-card:hover::before {
            opacity: 1;
        }
        
        .fund-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(139, 92, 246, 0.1);
            position: relative;
            gap: 8px; /* å‡å°‘é—´è·ï¼Œç»™æ ‡é¢˜æ›´å¤šç©ºé—´ */
        }
        
        .fund-header::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 40px;
            height: 2px;
            background: var(--gradient-primary);
            border-radius: 1px;
        }
        
        .fund-name {
            font-size: var(--text-xl);
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 6px;
            line-height: 1.3;
            letter-spacing: -0.02em;
            flex: 1; /* å æ®å‰©ä½™ç©ºé—´ */
            min-width: 0; /* å…è®¸æ”¶ç¼© */
            word-wrap: break-word; /* å…è®¸é•¿å•è¯æ¢è¡Œ */
            word-break: break-word; /* åœ¨åˆé€‚ä½ç½®æ¢è¡Œ */
        }
        
        .fund-code {
            font-size: var(--text-xs);
            color: var(--color-text-quaternary);
            font-family: var(--font-mono);
            line-height: 1.4;
        }
        
        .fund-type-badge {
            padding: 6px 12px;
            border-radius: 16px;
            font-size: var(--text-xs);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            flex-shrink: 0; /* é˜²æ­¢æ ‡ç­¾è¢«å‹ç¼© */
            white-space: nowrap; /* ç¡®ä¿æ ‡ç­¾æ–‡å­—ä¸æ¢è¡Œ */
            align-self: flex-start; /* ç¡®ä¿æ ‡ç­¾åœ¨é¡¶éƒ¨å¯¹é½ */
            margin-top: 2px; /* å¾®è°ƒä½ç½®ï¼Œä¸æ ‡é¢˜é¡¶éƒ¨å¯¹é½ */
        }
        
        .fund-type-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .fund-type-badge:hover::before {
            left: 100%;
        }
        
        .fund-type-badge.å®½åŸºæŒ‡æ•° {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 2px 8px rgba(139, 92, 246, 0.3);
        }
        
        .fund-type-badge.è¡Œä¸šä¸»é¢˜ {
            background: var(--gradient-secondary);
            color: white;
            box-shadow: 0 2px 8px rgba(6, 182, 212, 0.3);
        }
        
        .fund-type-badge.å›ºæ”¶+ {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
        }
        
        .fund-type-badge.å€ºåˆ¸åŸºé‡‘ {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            color: white;
            box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
        }
        
        .fund-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        /* KDJå‘¨çº¿åˆ†æåŒºåŸŸ */
        .kdj-analysis-section {
            margin-bottom: 16px;
        }
        
        .kdj-chart-container {
            margin-bottom: 12px;
            width: 100%; /* ç¡®ä¿å®¹å™¨å æ»¡å¡ç‰‡å®½åº¦ */
            overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡º */
            display: flex;
            flex-direction: column; /* å‚ç›´æ’åˆ— */
            align-items: center; /* æ°´å¹³å±…ä¸­ */
        }
        
        .chart-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 8px;
            text-align: center;
        }
        
        .kdj-chart-svg {
            border: 2px solid rgba(139, 92, 246, 0.1);
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.02) 0%, rgba(236, 72, 153, 0.02) 100%);
            width: 100%; /* è‡ªé€‚åº”å®¹å™¨å®½åº¦ */
            height: 120px; /* å‡å°‘é«˜åº¦é€‚åº”ä¸‰åˆ—å¸ƒå±€ */
            max-width: 100%; /* ç¡®ä¿ä¸è¶…å‡ºå®¹å™¨ */
            animation: chartRise 0.8s ease-out;
            cursor: crosshair; /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºåå­—å…‰æ ‡ */
        }
        
        /* Tooltipæ ·å¼ */
        .kdj-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .kdj-tooltip.show {
            opacity: 1;
        }
        
        .kdj-tooltip .tooltip-date {
            font-weight: 600;
            margin-bottom: 4px;
            color: #8B5CF6;
        }
        
        .kdj-tooltip .tooltip-values {
            display: flex;
            gap: 12px;
        }
        
        .kdj-tooltip .tooltip-value {
            text-align: center;
        }
        
        .kdj-tooltip .tooltip-value .label {
            font-size: 10px;
            opacity: 0.8;
            margin-bottom: 2px;
        }
        
        .kdj-tooltip .tooltip-value .value {
            font-weight: 600;
        }
        
        .kdj-tooltip .k-value { color: #8B5CF6; }
        .kdj-tooltip .d-value { color: #06B6D4; }
        .kdj-tooltip .j-value { color: #EC4899; }
        
        .data-line {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawLine 1.5s ease-in-out forwards;
        }
        
        /* KDJæ•°å€¼æ˜¾ç¤º */
        .kdj-values {
            display: flex;
            justify-content: space-between;
            margin-bottom: 16px;
            padding: 12px 16px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, rgba(236, 72, 153, 0.05) 100%);
            border-radius: 12px;
            border: 1px solid rgba(139, 92, 246, 0.1);
        }
        
        .kdj-value-item {
            text-align: center;
        }
        
        .kdj-value-label {
            font-size: var(--text-xs);
            color: var(--color-text-quaternary);
            margin-bottom: 2px;
        }
        
        .kdj-value-number {
            font-size: var(--text-sm);
            font-weight: 600;
            font-family: var(--font-mono);
        }
        
        .kdj-value-number.k-line {
            color: var(--color-data-1); /* æ´»åŠ›ç´«è‰² */
        }
        
        .kdj-value-number.d-line {
            color: var(--color-data-2); /* ç§‘æŠ€é’è‰² */
        }
        
        .kdj-value-number.j-line {
            color: var(--color-data-5); /* æ´»åŠ›ç²‰è‰² */
        }
        
        /* ç»¼åˆåˆ†æåŒºåŸŸ */
        .kdj-analysis {
            padding: 16px;
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.03) 0%, rgba(236, 72, 153, 0.03) 100%);
            border-radius: 12px;
            border-left: 4px solid var(--color-primary);
            position: relative;
            overflow: hidden;
        }
        
        .kdj-analysis::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.1) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .analysis-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 8px;
        }
        
        .analysis-content {
            font-size: var(--text-sm);
            line-height: 1.5;
        }
        
        .analysis-signal {
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: var(--text-sm);
        }
        
        .analysis-signal.bullish {
            background: var(--color-success-light);
            color: var(--color-success-dark);
            border: 1px solid var(--color-success);
        }
        
        .analysis-signal.bearish {
            background: var(--color-error-light);
            color: var(--color-error-dark);
            border: 1px solid var(--color-error);
        }
        
        .analysis-signal.neutral {
            background: var(--color-warning-light);
            color: var(--color-warning-dark);
            border: 1px solid var(--color-warning);
        }
        
        .analysis-details {
            margin-bottom: 8px;
        }
        
        .detail-item {
            margin-bottom: 4px;
            color: var(--color-text-secondary);
            font-size: var(--text-xs);
            line-height: 1.4;
        }
        
        .no-weekly-data {
            text-align: center;
            color: var(--color-text-quaternary);
            font-style: italic;
            padding: 24px;
            font-size: var(--text-sm);
        }
        
        .kdj-title {
            font-size: var(--text-sm);
            font-weight: 600;
            color: var(--color-text-secondary);
            margin-bottom: var(--space-3);
            text-align: center;
        }
        
        .kdj-lines {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--space-2);
            margin-bottom: var(--space-3);
        }
        
        .kdj-line {
            text-align: center;
        }
        
        .kdj-line-label {
            font-size: var(--text-xs);
            color: var(--color-text-tertiary);
            margin-bottom: var(--space-1);
        }
        
        .kdj-line-value {
            font-size: var(--text-sm);
            font-weight: 600;
            font-family: var(--font-mono);
        }
        
        .kdj-line-value.k-line {
            color: var(--color-primary);
        }
        
        .kdj-line-value.d-line {
            color: var(--color-info);
        }
        
        .kdj-line-value.j-line {
            color: var(--color-warning);
        }
        
        .kdj-line-value.rsv {
            color: var(--color-text-secondary);
        }
        
        .kdj-signal {
            font-size: var(--text-xs);
            text-align: center;
            padding: var(--space-2);
            border-radius: 8px;
            font-weight: 600;
        }
        
        .kdj-signal.bullish {
            background: rgba(16, 185, 129, 0.1);
            color: var(--color-success);
        }
        
        .kdj-signal.bearish {
            background: rgba(239, 68, 68, 0.1);
            color: var(--color-error);
        }
        
        .kdj-signal.neutral {
            background: rgba(107, 114, 128, 0.1);
            color: var(--color-text-secondary);
        }
        
        .kdj-signal.overbought {
            background: rgba(245, 158, 11, 0.1);
            color: var(--color-warning);
        }
        
        .kdj-signal.oversold {
            background: rgba(139, 92, 246, 0.1);
            color: var(--color-primary);
        }
        
        .kdj-chart {
            height: 60px;
            margin-bottom: var(--space-3);
            border-radius: 8px;
            overflow: hidden;
            background: var(--color-bg-secondary);
            position: relative;
        }
        
        .kdj-chart svg {
            width: 100%;
            height: 100%;
        }
        
        .kdj-legend {
            display: flex;
            justify-content: center;
            gap: var(--space-4);
            font-size: var(--text-xs);
            color: var(--color-text-tertiary);
        }
        
        .kdj-legend-item {
            display: flex;
            align-items: center;
            gap: var(--space-1);
        }
        
        .kdj-legend-color {
            width: 8px;
            height: 8px;
            border-radius: 2px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: var(--text-xl);
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .stat-value.positive {
            color: var(--color-success);
        }
        
        .stat-value.negative {
            color: var(--color-error);
        }
        
        .stat-label {
            font-size: var(--text-sm);
            color: var(--color-text-secondary);
        }
        
        .fund-chart-mini {
            height: 40px;
            margin-bottom: var(--space-4);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .data-line {
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
            animation: drawLine 1.5s ease-in-out forwards;
        }
        
        .data-source {
            display: flex;
            align-items: center;
            gap: var(--space-2);
            font-size: var(--text-xs);
            color: var(--color-text-tertiary);
        }
        
        .data-source-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .data-source-indicator.real {
            background: var(--color-success);
        }
        
        .data-source-indicator.mock {
            background: var(--color-warning);
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: var(--space-16);
            color: var(--color-text-secondary);
            grid-column: 1 / -1; /* è·¨è¶Šæ‰€æœ‰åˆ— */
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid var(--color-border);
            border-top: 3px solid var(--color-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: var(--space-4);
        }
        
        .error {
            background: rgba(239, 68, 68, 0.1);
            color: var(--color-error);
            padding: var(--space-4);
            border-radius: 12px;
            margin: var(--space-4) 0;
            border-left: 4px solid var(--color-error);
            grid-column: 1 / -1; /* è·¨è¶Šæ‰€æœ‰åˆ— */
        }
        
        .success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--color-success);
            padding: var(--space-4);
            border-radius: 12px;
            margin: var(--space-4) 0;
            border-left: 4px solid var(--color-success);
            grid-column: 1 / -1; /* è·¨è¶Šæ‰€æœ‰åˆ— */
        }
        
        /* éšè—æ•°æ®ç»Ÿè®¡æ–‡æ¡ˆ */
        .success p:nth-child(2) {
            display: none;
        }
        
        /* ç»Ÿè®¡å­—æ®µæ˜¾ç¤ºæ§åˆ¶å¼€å…³æ ·å¼ */
        .stats-control {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            padding: 0 20px;
        }
        
        .toggle-switch {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }
        
        .toggle-switch input[type="checkbox"] {
            display: none;
        }
        
        .toggle-slider {
            position: relative;
            width: 50px;
            height: 24px;
            background: var(--color-border);
            border-radius: 12px;
            transition: all 0.3s ease;
            margin-right: 12px;
        }
        
        .toggle-slider::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background: var(--color-primary);
        }
        
        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(26px);
        }
        
        .toggle-label {
            font-size: 14px;
            color: var(--color-text-secondary);
            font-weight: 500;
        }
        
        /* å¯åˆ‡æ¢ç»Ÿè®¡å­—æ®µæ ·å¼ */
        .toggleable-stat {
            transition: all 0.3s ease;
        }
        
        .toggleable-stat.hidden {
            display: none;
        }
        
        /* è‡ªé€‚åº”å¸ƒå±€ - å½“éšè—å­—æ®µæ—¶è°ƒæ•´å‰©ä½™å­—æ®µå¸ƒå±€ */
        .stats-grid.adaptive-2-cols {
            grid-template-columns: repeat(2, 1fr);
            justify-items: center;
        }
        
        .stats-grid.adaptive-2-cols .stat-card {
            max-width: 300px;
        }
        
        /* åŠ¨ç”» */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes countUp {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* é’æ˜¥æ´»åŠ›åŠ¨ç”» */
        @keyframes chartRise {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        @keyframes drawLine {
            to {
                stroke-dashoffset: 0;
            }
        }
        
        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.4);
            }
            50% {
                box-shadow: 0 0 0 8px rgba(139, 92, 246, 0);
            }
        }
        
        @keyframes ripple {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
            }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .fund-grid {
                grid-template-columns: repeat(2, 1fr); /* ä¸­ç­‰å±å¹•æ—¶ä¸¤åˆ—æ˜¾ç¤º */
                gap: 12px;
            }
            
            /* ä¸¤åˆ—å¸ƒå±€ä¸‹çš„æ ‡é¢˜ä¼˜åŒ– - å…è®¸æ¢è¡Œæ˜¾ç¤º */
            .fund-grid .fund-name {
                /* å…è®¸æ ‡é¢˜å®Œæ•´æ˜¾ç¤ºå¹¶æ¢è¡Œ */
            }
        }
        
        @media (max-width: 900px) {
            .fund-grid {
                grid-template-columns: 1fr; /* å°å±å¹•æ—¶å•åˆ—æ˜¾ç¤º */
                gap: 12px; /* å•åˆ—æ—¶å‡å°‘é—´è· */
            }
            
            /* å•åˆ—å¸ƒå±€ä¸‹çš„æ ‡é¢˜ä¼˜åŒ– - å…è®¸æ¢è¡Œæ˜¾ç¤º */
            .fund-grid .fund-name {
                /* å…è®¸æ ‡é¢˜å®Œæ•´æ˜¾ç¤ºå¹¶æ¢è¡Œ */
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: var(--space-4);
            }
            
            .header h1 {
                font-size: var(--text-4xl);
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .fund-grid {
                grid-template-columns: 1fr;
                padding: 0 4px; /* å°å±å¹•æ—¶å‡å°‘å·¦å³å†…è¾¹è· */
            }
            
            .filter-tabs {
                flex-wrap: wrap;
            }
            
            .filter-tab {
                flex: none;
                min-width: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨åŒºåŸŸ -->
        <div class="header">
            <div class="header-content">
                <h1>ğŸš€ åŸºé‡‘ç›‘æ§ç³»ç»Ÿ V4</h1>
                <p>é’æ˜¥çµåŠ¨ç‰ˆ - æœ¬åœ°å¼€å‘ç‰ˆï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰</p>
                <div class="local-dev-notice">
                    <strong>ğŸ’¡ æœ¬åœ°å¼€å‘æ¨¡å¼</strong><br>
                    å½“å‰ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼Œå¦‚éœ€çœŸå®æ•°æ®è¯·è®¿é—®ï¼š<a href="http://47.95.118.57:8090/" target="_blank" style="color: var(--color-success);">http://47.95.118.57:8090/</a>
                </div>
                <div class="data-source">
                    <span>æ•°æ®æº: æœ¬åœ°æ¨¡æ‹Ÿæ•°æ®</span>
                    <span>|</span>
                    <span id="lastUpdate">æ›´æ–°æ—¶é—´: -</span>
                </div>
            </div>
        </div>
        
        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalFunds">-</div>
                <div class="stat-label">ç›‘æ§åŸºé‡‘æ•°é‡</div>
                <div class="stat-description">æŒ‰åˆ†ç±»æ™ºèƒ½ç›‘æ§</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="realDataRatio">-</div>
                <div class="stat-label">çœŸå®æ•°æ®æ¯”ä¾‹</div>
                <div class="stat-description">æ•°æ®è´¨é‡æŒ‡æ ‡</div>
            </div>
            <div class="stat-card toggleable-stat" id="avgRealDaysCard">
                <div class="stat-value" id="avgRealDays">-</div>
                <div class="stat-label">å¹³å‡çœŸå®å¤©æ•°</div>
                <div class="stat-description">æ•°æ®ç§¯ç´¯ç¨‹åº¦</div>
            </div>
            <div class="stat-card toggleable-stat" id="maxRealDaysCard">
                <div class="stat-value" id="maxRealDays">-</div>
                <div class="stat-label">æœ€å¤§çœŸå®å¤©æ•°</div>
                <div class="stat-description">æœ€ä½³æ•°æ®è´¨é‡</div>
            </div>
        </div>
        
        <!-- ç»Ÿè®¡å­—æ®µæ˜¾ç¤ºæ§åˆ¶å¼€å…³ -->
        <div class="stats-control">
            <label class="toggle-switch">
                <input type="checkbox" id="statsToggle">
                <span class="toggle-slider"></span>
                <span class="toggle-label">æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡</span>
            </label>
        </div>
        
        <!-- ç­›é€‰å™¨ -->
        <div class="filter-section">
            <div class="filter-tabs">
                <button class="filter-tab active" data-category="all">å…¨éƒ¨åŸºé‡‘</button>
                <button class="filter-tab" data-category="å®½åŸºæŒ‡æ•°">å®½åŸºæŒ‡æ•°</button>
                <button class="filter-tab" data-category="è¡Œä¸šä¸»é¢˜">è¡Œä¸šä¸»é¢˜</button>
                <button class="filter-tab" data-category="å›ºæ”¶+">å›ºæ”¶+</button>
                <button class="filter-tab" data-category="å€ºåˆ¸åŸºé‡‘">å€ºåˆ¸åŸºé‡‘</button>
            </div>
        </div>
        
        <!-- åŸºé‡‘åˆ—è¡¨ -->
        <div class="fund-list">
            <div id="fundContainer" class="fund-grid">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div>æ­£åœ¨åŠ è½½åŸºé‡‘æ•°æ®...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æœ¬åœ°å¼€å‘æ¨¡å¼ - ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
        let allFunds = [];
        let currentCategory = 'all';
        
        // å¤©å¤©åŸºé‡‘æ•°æ®æ”¶é›†é…ç½®
        const TIAN_TIAN_FUND_API = {
            baseUrl: 'http://fundgz.1234567.com.cn/js/',
            headers: {
                'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36',
                'Referer': 'http://fund.eastmoney.com/',
                'Accept': 'application/json, text/javascript, */*; q=0.01'
            }
        };
        
        // å¤©å¤©åŸºé‡‘æ•°æ®æ”¶é›†å‡½æ•°
        async function collectTianTianFundData(fundCode) {
            try {
                const url = `${TIAN_TIAN_FUND_API.baseUrl}${fundCode}.js`;
                const response = await fetch(url, {
                    method: 'GET',
                    headers: TIAN_TIAN_FUND_API.headers,
                    mode: 'cors'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const text = await response.text();
                // è§£æJSONPå“åº”
                const jsonStr = text.replace(/^jsonpgz\(/, '').replace(/\);$/, '');
                const data = JSON.parse(jsonStr);
                
                return {
                    code: data.fundcode,
                    name: data.name,
                    nav: parseFloat(data.gsz),
                    change: parseFloat(data.gszzl),
                    date: data.gztime,
                    source: 'real'
                };
            } catch (error) {
                console.warn(`è·å–åŸºé‡‘ ${fundCode} æ•°æ®å¤±è´¥:`, error.message);
                return null;
            }
        }
        
        // æ‰¹é‡æ”¶é›†å¤©å¤©åŸºé‡‘æ•°æ®
        async function collectAllFundsData() {
            const allFundCodes = Object.values(fundCategories).flat().map(fund => fund.code);
            const realData = [];
            
            console.log('å¼€å§‹æ”¶é›†å¤©å¤©åŸºé‡‘çœŸå®æ•°æ®...');
            
            for (const fundCode of allFundCodes.slice(0, 10)) { // é™åˆ¶æ•°é‡é¿å…è¯·æ±‚è¿‡å¤š
                try {
                    const fundData = await collectTianTianFundData(fundCode);
                    if (fundData) {
                        realData.push(fundData);
                        console.log(`âœ… æˆåŠŸè·å–åŸºé‡‘ ${fundCode} æ•°æ®`);
                    }
                } catch (error) {
                    console.warn(`âŒ è·å–åŸºé‡‘ ${fundCode} æ•°æ®å¤±è´¥:`, error.message);
                }
                
                // æ·»åŠ å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡äºé¢‘ç¹
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            console.log(`æ•°æ®æ”¶é›†å®Œæˆï¼Œå…±è·å– ${realData.length} ä¸ªåŸºé‡‘çš„çœŸå®æ•°æ®`);
            return realData;
        }
        
        // æ•°æ®å­˜å‚¨å’ŒåŠ è½½
        function saveFundData(fundData) {
            try {
                localStorage.setItem('fund_monitoring_data', JSON.stringify({
                    data: fundData,
                    lastUpdate: new Date().toISOString()
                }));
                console.log('åŸºé‡‘æ•°æ®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
            } catch (error) {
                console.warn('ä¿å­˜æ•°æ®å¤±è´¥:', error.message);
            }
        }
        
        function loadFundData() {
            try {
                const stored = localStorage.getItem('fund_monitoring_data');
                if (stored) {
                    const parsed = JSON.parse(stored);
                    const lastUpdate = new Date(parsed.lastUpdate);
                    const now = new Date();
                    const hoursDiff = (now - lastUpdate) / (1000 * 60 * 60);
                    
                    // å¦‚æœæ•°æ®è¶…è¿‡24å°æ—¶ï¼Œè¿”å›nullå¼ºåˆ¶é‡æ–°æ”¶é›†
                    if (hoursDiff < 24) {
                        console.log('åŠ è½½æœ¬åœ°å­˜å‚¨çš„åŸºé‡‘æ•°æ®');
                        return parsed.data;
                    } else {
                        console.log('æœ¬åœ°æ•°æ®è¿‡æœŸï¼Œéœ€è¦é‡æ–°æ”¶é›†');
                        return null;
                    }
                }
            } catch (error) {
                console.warn('åŠ è½½æœ¬åœ°æ•°æ®å¤±è´¥:', error.message);
            }
            return null;
        }
        
        // åŸºé‡‘åˆ†ç±»æ•°æ®
        const fundCategories = {
            "å®½åŸºæŒ‡æ•°": [
                { code: "000001", name: "åå¤ä¸Šè¯50ETFè”æ¥A" },
                { code: "110022", name: "æ˜“æ–¹è¾¾æ²ªæ·±300ETFè”æ¥A" },
                { code: "161725", name: "æ‹›å•†ä¸­è¯500ETFè”æ¥A" },
                { code: "501305", name: "æ±‡æ·»å¯Œä¸­è¯æ¸¯è‚¡é€šé«˜è‚¡æ¯æŠ•èµ„ETFè”æ¥(LOF)A" },
                { code: "501306", name: "æ±‡æ·»å¯Œä¸­è¯æ¸¯è‚¡é€šçº¢åˆ©ETFè”æ¥(LOF)A" },
                { code: "501307", name: "æ±‡æ·»å¯Œæ’ç”Ÿç§‘æŠ€ETFè”æ¥(LOF)A" },
                { code: "501308", name: "æ±‡æ·»å¯Œä¸­è¯èŠ¯ç‰‡äº§ä¸šETFè”æ¥(LOF)A" },
                { code: "501309", name: "æ±‡æ·»å¯Œåˆ›ä¸šæ¿ETFè”æ¥(LOF)A" },
                { code: "501310", name: "æ±‡æ·»å¯Œç§‘åˆ›50è”æ¥(LOF)A" },
                { code: "501311", name: "æ±‡æ·»å¯Œäººå·¥æ™ºèƒ½ETFè”æ¥(LOF)A" },
                { code: "501312", name: "æ±‡æ·»å¯Œè¯åˆ¸ä¿é™©ETFè”æ¥(LOF)A" },
                { code: "501313", name: "æ±‡æ·»å¯Œä¸­å›½å¤®ä¼çº¢åˆ©ETFè”æ¥(LOF)A" }
            ],
            "è¡Œä¸šä¸»é¢˜": [
                { code: "006493", name: "æ˜“æ–¹è¾¾è“ç­¹ç²¾é€‰æ··åˆA" },
                { code: "005827", name: "æ˜“æ–¹è¾¾è“ç­¹ç²¾é€‰æ··åˆC" },
                { code: "001234", name: "æ™¯é¡ºé•¿åŸå“è´¨é•¿é’æ··åˆA" },
                { code: "001235", name: "æ™¯é¡ºé•¿åŸå®æ™¯6ä¸ªæœˆæŒæœ‰æœŸæ··åˆA" },
                { code: "001236", name: "åæ³°æŸç‘å®‰æ³½ç¨³åˆ©9ä¸ªæœˆæŒæœ‰æœŸæ··åˆA" },
                { code: "001237", name: "å¤©å¼˜è£•æƒ å›æŠ¥å®šæœŸå¼€æ”¾å¼æ··åˆA" },
                { code: "001238", name: "ä¸­é‡‘æ¬£åˆ©æ··åˆA" },
                { code: "001239", name: "åšæ—¶æ’é€šå…­ä¸ªæœˆæŒæœ‰æœŸæ··åˆA" },
                { code: "001240", name: "å¹¿å‘ç›ˆé€‰ç¨³å¥6ä¸ªæœˆæŒæœ‰æ··åˆå‘èµ·(FOF)A" },
                { code: "001241", name: "æ‹›å•†æ’æ³½æ··åˆA" },
                { code: "001242", name: "æ˜“æ–¹è¾¾çº¢åˆ©ä¼˜äº«çµæ´»é…ç½®æ··åˆA" },
                { code: "001243", name: "æµ·å¯Œé€šç›ˆä¸°ç¨³å¥6ä¸ªæœˆæŒæœ‰æ··åˆ(FOF)A" },
                { code: "001244", name: "å˜‰å®ç‘¾é€šçµæ´»é…ç½®æ··åˆA" }
            ],
            "å›ºæ”¶+": [
                { code: "002001", name: "æ™¯é¡ºé•¿åŸæ™¯é¢æ‹›åˆ©6ä¸ªæœˆæŒæœ‰æœŸå€ºåˆ¸A" },
                { code: "002002", name: "åæ³°æŸç‘ç¨³å¥å¢åˆ©å€ºåˆ¸A" },
                { code: "002003", name: "å¤©å¼˜å˜‰å®ä¿¡ç”¨C" },
                { code: "002004", name: "ä¸­é‡‘åŒ—è¯50æˆä»½æŒ‡æ•°A" },
                { code: "002005", name: "åšæ—¶ä¸­è¯500æŒ‡æ•°å¢å¼ºA" },
                { code: "002006", name: "å¹¿å‘æ²ªæ·±300æŒ‡æ•°å¢å¼ºA" },
                { code: "002007", name: "æ‹›å•†å¤©å¼˜æ’ç”Ÿç§‘æŠ€ETFè”æ¥(QDII)C" },
                { code: "002008", name: "æ˜“æ–¹è¾¾ä¸­æ¬§ç›ˆé€‰ç¨³å¥6ä¸ªæœˆæŒæœ‰æ··åˆå‘èµ·(FOF)E" },
                { code: "002009", name: "æµ·å¯Œé€šä¸œæ–¹çº¢ç›ˆä¸°ç¨³å¥6ä¸ªæœˆæŒæœ‰æ··åˆ(FOF)C" }
            ],
            "å€ºåˆ¸åŸºé‡‘": [
                { code: "003001", name: "åå¤çº¯å€ºå€ºåˆ¸A" },
                { code: "003002", name: "æ˜“æ–¹è¾¾ä¿¡ç”¨å€ºå€ºåˆ¸A" },
                { code: "003003", name: "æ‹›å•†ä¸­çŸ­å€ºå€ºåˆ¸A" },
                { code: "003004", name: "å¹¿å‘åˆ©ç‡å€ºå€ºåˆ¸A" },
                { code: "003005", name: "åšæ—¶å¯è½¬å€ºå€ºåˆ¸A" }
            ]
        };
        
        // è·å–åŸºé‡‘ç±»å‹
        function getFundType(code) {
            for (const [type, funds] of Object.entries(fundCategories)) {
                if (funds.some(fund => fund.code === code)) {
                    return type;
                }
            }
            return 'æœªçŸ¥';
        }
        
        // æ ¼å¼åŒ–æ•°å­—
        function formatNumber(num) {
            return parseFloat(num).toFixed(4);
        }
        
        // æ ¼å¼åŒ–ç™¾åˆ†æ¯”
        function formatPercent(num) {
            const sign = num >= 0 ? '+' : '';
            return `${sign}${parseFloat(num).toFixed(2)}%`;
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('zh-CN');
        }
        
        // è·å–å˜åŒ–æ ·å¼ç±»
        function getChangeClass(change) {
            return parseFloat(change) >= 0 ? 'positive' : 'negative';
        }
        
        // KDJä¿¡å·åˆ†æ
        function analyzeKDJSignal(kdjData) {
            if (!kdjData || kdjData.length < 2) return { signal: 'neutral', text: 'æ•°æ®ä¸è¶³' };
            
            const latest = kdjData[0];
            const previous = kdjData[1];
            
            const { k, d, j } = latest;
            const prevK = previous.k;
            const prevD = previous.d;
            
            // é‡‘å‰æ­»å‰åˆ¤æ–­
            const goldenCross = k > d && prevK <= prevD;
            const deathCross = k < d && prevK >= prevD;
            
            // è¶…ä¹°è¶…å–åˆ¤æ–­
            const overbought = k > 80 && d > 80;
            const oversold = k < 20 && d < 20;
            
            // Jçº¿æç«¯å€¼åˆ¤æ–­
            const jExtremeHigh = j > 100;
            const jExtremeLow = j < 0;
            
            // ç»¼åˆä¿¡å·åˆ¤æ–­
            if (jExtremeHigh) {
                return { signal: 'overbought', text: 'J>100 æç«¯è¶…ä¹°' };
            } else if (jExtremeLow) {
                return { signal: 'oversold', text: 'J<0 æç«¯è¶…å–' };
            } else if (goldenCross && oversold) {
                return { signal: 'bullish', text: 'é‡‘å‰+è¶…å– ä¹°å…¥ä¿¡å·' };
            } else if (deathCross && overbought) {
                return { signal: 'bearish', text: 'æ­»å‰+è¶…ä¹° å–å‡ºä¿¡å·' };
            } else if (goldenCross) {
                return { signal: 'bullish', text: 'Kä¸Šç©¿D é‡‘å‰ä¿¡å·' };
            } else if (deathCross) {
                return { signal: 'bearish', text: 'Kä¸‹ç©¿D æ­»å‰ä¿¡å·' };
            } else if (overbought) {
                return { signal: 'overbought', text: 'KD>80 è¶…ä¹°åŒºåŸŸ' };
            } else if (oversold) {
                return { signal: 'oversold', text: 'KD<20 è¶…å–åŒºåŸŸ' };
            } else {
                return { signal: 'neutral', text: 'éœ‡è¡æ•´ç†' };
            }
        }
        
        // ç”ŸæˆKDJå‘¨çº¿èµ°åŠ¿å›¾ - åº”ç”¨æ–°è®¾è®¡è§„èŒƒ
        function generateKDJWeeklyChart(weeklyKDJ, width = '100%', height = 100) {
            if (!weeklyKDJ || weeklyKDJ.length === 0) return '';
            
            // ä½¿ç”¨å›ºå®šåƒç´ å®½åº¦ï¼Œç¡®ä¿å›¾è¡¨å……åˆ†åˆ©ç”¨ç©ºé—´
            const svgWidth = 400; // å›ºå®šå®½åº¦ï¼ŒCSSä¼šç¼©æ”¾ä¸º100%
            const svgHeight = height;
            const padding = { top: 15, right: 30, bottom: 25, left: 30 }; // å¯¹ç§°paddingï¼Œè®©å›¾è¡¨å±…ä¸­
            const chartWidth = svgWidth - padding.left - padding.right; // 340px
            const chartHeight = svgHeight - padding.top - padding.bottom;
            
            // è·å–Kã€Dã€Jçš„å€¼èŒƒå›´
            const allValues = weeklyKDJ.flatMap(d => [d.k, d.d, d.j]);
            const minValue = Math.min(...allValues, 0);
            const maxValue = Math.max(...allValues, 100);
            const valueRange = maxValue - minValue;
            
            // è®¡ç®—åæ ‡
            const getY = (value) => {
                return padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
            };
            
            const getX = (index) => {
                return padding.left + (index / (weeklyKDJ.length - 1)) * chartWidth;
            };
            
            // ç”ŸæˆKçº¿è·¯å¾„
            const kPath = weeklyKDJ.map((d, i) => {
                const x = getX(i);
                const y = getY(d.k);
                return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
            }).join(' ');
            
            // ç”ŸæˆDçº¿è·¯å¾„
            const dPath = weeklyKDJ.map((d, i) => {
                const x = getX(i);
                const y = getY(d.d);
                return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
            }).join(' ');
            
            // ç”ŸæˆJçº¿è·¯å¾„
            const jPath = weeklyKDJ.map((d, i) => {
                const x = getX(i);
                const y = getY(d.j);
                return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
            }).join(' ');
            
            // ç”Ÿæˆæ—¥æœŸæ ‡ç­¾ - é€‚åº”52å‘¨æ•°æ®ï¼Œæ˜¾ç¤ºæ›´å¤šæ—¶é—´ç‚¹
            const dateLabels = weeklyKDJ.map((d, i) => {
                if (i % Math.ceil(weeklyKDJ.length / 8) === 0) { // æ˜¾ç¤º8ä¸ªæ—¶é—´ç‚¹
                    const date = new Date(d.date);
                    const month = date.getMonth() + 1;
                    const day = date.getDate();
                    const x = getX(i);
                    return `<text x="${x}" y="${svgHeight - 5}" text-anchor="middle" font-size="8" fill="#8C8C8C">${month}/${day}</text>`;
                }
                return '';
            }).join('');
            
            // ç”ŸæˆYè½´æ ‡ç­¾
            const yLabels = [0, 20, 50, 80, 100].map(value => {
                const y = getY(value);
                return `<text x="${padding.left - 5}" y="${y + 3}" text-anchor="end" font-size="9" fill="#8C8C8C">${value}</text>`;
            }).join('');
            
            const chartId = `chart-${Math.random().toString(36).substr(2, 9)}`;
            
            return `
                <div class="chart-wrapper" style="position: relative; width: 100%;">
                    <svg id="${chartId}" width="${svgWidth}" height="${svgHeight}" class="kdj-chart-svg">
                        <!-- èƒŒæ™¯ç½‘æ ¼ -->
                        <defs>
                            <pattern id="grid-${chartId}" width="20" height="20" patternUnits="userSpaceOnUse">
                                <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#F0F0F0" stroke-width="1"/>
                            </pattern>
                        </defs>
                        <rect width="100%" height="100%" fill="url(#grid-${chartId})"/>
                        
                        <!-- 80/20å‚è€ƒçº¿ -->
                        <line x1="${padding.left}" y1="${getY(80)}" x2="${padding.left + chartWidth}" y2="${getY(80)}" stroke="#FF4D4F" stroke-width="1" stroke-dasharray="3,3" opacity="0.6"/>
                        <line x1="${padding.left}" y1="${getY(20)}" x2="${padding.left + chartWidth}" y2="${getY(20)}" stroke="#00A76B" stroke-width="1" stroke-dasharray="3,3" opacity="0.6"/>
                        <line x1="${padding.left}" y1="${getY(50)}" x2="${padding.left + chartWidth}" y2="${getY(50)}" stroke="#8C8C8C" stroke-width="1" stroke-dasharray="1,1" opacity="0.4"/>
                        
                        <!-- Kçº¿ - æ´»åŠ›ç´«è‰² -->
                        <path d="${kPath}" stroke="#8B5CF6" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="data-line"/>
                        <!-- Dçº¿ - ç§‘æŠ€é’è‰² -->
                        <path d="${dPath}" stroke="#06B6D4" stroke-width="1.5" fill="none" stroke-linecap="round" stroke-linejoin="round" class="data-line"/>
                        <!-- Jçº¿ - æ´»åŠ›ç²‰è‰² -->
                        <path d="${jPath}" stroke="#EC4899" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="data-line"/>
                        
                        <!-- äº¤äº’åŒºåŸŸ -->
                        <rect x="${padding.left}" y="${padding.top}" width="${chartWidth}" height="${chartHeight}" 
                              fill="transparent" class="interaction-area" 
                              data-chart-id="${chartId}" data-weekly-data='${JSON.stringify(weeklyKDJ)}'/>
                        
                        <!-- åæ ‡è½´æ ‡ç­¾ -->
                        ${dateLabels}
                        ${yLabels}
                    </svg>
                    
                    <!-- Tooltip -->
                    <div class="kdj-tooltip" id="tooltip-${chartId}">
                        <div class="tooltip-date"></div>
                        <div class="tooltip-values">
                            <div class="tooltip-value">
                                <div class="label">Kçº¿</div>
                                <div class="value k-value"></div>
                            </div>
                            <div class="tooltip-value">
                                <div class="label">Dçº¿</div>
                                <div class="value d-value"></div>
                            </div>
                            <div class="tooltip-value">
                                <div class="label">Jçº¿</div>
                                <div class="value j-value"></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ç”ŸæˆKDJå›¾è¡¨SVGï¼ˆä¿æŒåŸæœ‰å°å›¾è¡¨åŠŸèƒ½ï¼‰
        function generateKDJChart(kdjData, width = 100, height = 60) {
            if (!kdjData || kdjData.length < 2) return '';
            
            const data = kdjData.slice(0, 20).reverse(); // å–æœ€è¿‘20ä¸ªæ•°æ®ç‚¹
            const maxVal = Math.max(...data.map(d => Math.max(d.k, d.d, d.j)));
            const minVal = Math.min(...data.map(d => Math.min(d.k, d.d, d.j)));
            const range = maxVal - minVal || 100;
            
            const scaleX = width / (data.length - 1);
            const scaleY = height / range;
            
            const points = data.map((d, i) => ({
                x: i * scaleX,
                y: height - ((d.k - minVal) * scaleY),
                k: d.k,
                d: d.d,
                j: d.j
            }));
            
            const kPath = points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ');
            const dPath = points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${height - ((p.d - minVal) * scaleY)}`).join(' ');
            const jPath = points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${height - ((p.j - minVal) * scaleY)}`).join(' ');
            
            return `
                <svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">
                    <!-- èƒŒæ™¯ç½‘æ ¼ -->
                    <defs>
                        <pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse">
                            <path d="M 10 0 L 0 0 0 10" fill="none" stroke="#f3f4f6" stroke-width="0.5"/>
                        </pattern>
                    </defs>
                    <rect width="100%" height="100%" fill="url(#grid)"/>
                    
                    <!-- 80å’Œ20æ°´å¹³çº¿ -->
                    <line x1="0" y1="${height - ((80 - minVal) * scaleY)}" x2="${width}" y2="${height - ((80 - minVal) * scaleY)}" stroke="#ef4444" stroke-width="1" stroke-dasharray="2,2" opacity="0.5"/>
                    <line x1="0" y1="${height - ((20 - minVal) * scaleY)}" x2="${width}" y2="${height - ((20 - minVal) * scaleY)}" stroke="#10b981" stroke-width="1" stroke-dasharray="2,2" opacity="0.5"/>
                    
                    <!-- KDJçº¿æ¡ -->
                    <path d="${kPath}" stroke="#8b5cf6" stroke-width="2" fill="none" class="data-line"/>
                    <path d="${dPath}" stroke="#06b6d4" stroke-width="2" fill="none" class="data-line"/>
                    <path d="${jPath}" stroke="#f59e0b" stroke-width="2" fill="none" class="data-line"/>
                </svg>
            `;
        }
        
        // KDJæŒ‡æ ‡è®¡ç®—å‡½æ•°
        function calculateKDJ(priceData, n = 9, m1 = 3, m2 = 3) {
            if (priceData.length < n) return [];
            
            const kdjData = [];
            let k = 50, d = 50; // åˆå§‹å€¼
            
            for (let i = n - 1; i < priceData.length; i++) {
                // è·å–è¿‡å»nå¤©çš„æ•°æ®
                const periodData = priceData.slice(i - n + 1, i + 1);
                const high = Math.max(...periodData.map(d => d.high));
                const low = Math.min(...periodData.map(d => d.low));
                const close = priceData[i].close;
                
                // è®¡ç®—RSV
                const rsv = high === low ? 50 : ((close - low) / (high - low)) * 100;
                
                // è®¡ç®—Kå€¼
                k = (2/3) * k + (1/3) * rsv;
                
                // è®¡ç®—Då€¼
                d = (2/3) * d + (1/3) * k;
                
                // è®¡ç®—Jå€¼
                const j = 3 * k - 2 * d;
                
                kdjData.push({
                    date: priceData[i].date,
                    rsv: parseFloat(rsv.toFixed(2)),
                    k: parseFloat(k.toFixed(2)),
                    d: parseFloat(d.toFixed(2)),
                    j: parseFloat(j.toFixed(2))
                });
            }
            
            return kdjData;
        }
        
        // ç”Ÿæˆå‘¨çº¿æ•°æ®ï¼ˆä»æ—¥çº¿æ•°æ®ä¸­æå–ï¼‰
        function generateWeeklyData(dailyData) {
            const weeklyData = [];
            const weeks = {};
            
            // æŒ‰å‘¨åˆ†ç»„
            dailyData.forEach(day => {
                const date = new Date(day.date);
                const year = date.getFullYear();
                const week = getWeekNumber(date);
                const weekKey = `${year}-W${week}`;
                
                if (!weeks[weekKey]) {
                    weeks[weekKey] = [];
                }
                weeks[weekKey].push(day);
            });
            
            // ç”Ÿæˆå‘¨çº¿æ•°æ®
            Object.values(weeks).forEach(weekData => {
                if (weekData.length > 0) {
                    const high = Math.max(...weekData.map(d => d.high));
                    const low = Math.min(...weekData.map(d => d.low));
                    const close = weekData[0].close; // æœ€æ–°ä¸€å¤©çš„æ”¶ç›˜ä»·
                    const open = weekData[weekData.length - 1].close; // æœ€æ—©ä¸€å¤©çš„æ”¶ç›˜ä»·ä½œä¸ºå¼€ç›˜ä»·
                    
                    weeklyData.push({
                        date: weekData[0].date,
                        open: open,
                        high: high,
                        low: low,
                        close: close,
                        nav: close.toFixed(4),
                        change: ((close - open) / open * 100).toFixed(2),
                        source: weekData[0].source
                    });
                }
            });
            
            return weeklyData.sort((a, b) => new Date(a.date) - new Date(b.date)); // æŒ‰æ—¶é—´æ­£åºæ’åˆ—
        }
        
        // ç”Ÿæˆæœˆçº¿æ•°æ®ï¼ˆä»æ—¥çº¿æ•°æ®ä¸­æå–ï¼‰
        function generateMonthlyData(dailyData) {
            const monthlyData = [];
            const months = {};
            
            // æŒ‰æœˆåˆ†ç»„
            dailyData.forEach(day => {
                const date = new Date(day.date);
                const year = date.getFullYear();
                const month = date.getMonth() + 1;
                const monthKey = `${year}-${month.toString().padStart(2, '0')}`;
                
                if (!months[monthKey]) {
                    months[monthKey] = [];
                }
                months[monthKey].push(day);
            });
            
            // ç”Ÿæˆæœˆçº¿æ•°æ®
            Object.values(months).forEach(monthData => {
                if (monthData.length > 0) {
                    const high = Math.max(...monthData.map(d => d.high));
                    const low = Math.min(...monthData.map(d => d.low));
                    const close = monthData[0].close;
                    const open = monthData[monthData.length - 1].close;
                    
                    monthlyData.push({
                        date: monthData[0].date,
                        open: open,
                        high: high,
                        low: low,
                        close: close,
                        nav: close.toFixed(4),
                        change: ((close - open) / open * 100).toFixed(2),
                        source: monthData[0].source
                    });
                }
            });
            
            return monthlyData.sort((a, b) => new Date(b.date) - new Date(a.date));
        }
        
        // è·å–å‘¨æ•°
        function getWeekNumber(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }
        
        // åŸºäºKDJåŠ¨é‡è§‚æµ‹çš„ç»¼åˆåˆ¤æ–­
        function analyzeKDJMomentum(weeklyKDJ) {
            if (!weeklyKDJ || weeklyKDJ.length < 2) {
                return {
                    signal: 'neutral',
                    confidence: 0,
                    analysis: 'æ•°æ®ä¸è¶³ï¼Œæ— æ³•åˆ†æ',
                    details: []
                };
            }
            
            const latest = weeklyKDJ[0];
            const previous = weeklyKDJ[1];
            const k = latest.k;
            const d = latest.d;
            const j = latest.j;
            const prevK = previous.k;
            const prevD = previous.d;
            const prevJ = previous.j;
            
            let signal = 'neutral';
            let confidence = 0;
            let analysis = '';
            let details = [];
            
            // 1. è¶…ä¹°è¶…å–åŒºåŸŸåˆ¤æ–­
            if (k > 80 && d > 80) {
                details.push('Kã€Dçº¿è¿›å…¥è¶…ä¹°åŒº(>80)');
                if (j > 100) {
                    details.push('Jçº¿æç«¯è¶…ä¹°(>100)ï¼Œè­¦æƒ•é’åŒ–');
                    signal = 'bearish';
                    confidence += 0.3;
                } else {
                    details.push('Jçº¿æœªæç«¯ï¼Œå…³æ³¨å›è°ƒä¿¡å·');
                }
            } else if (k < 20 && d < 20) {
                details.push('Kã€Dçº¿è¿›å…¥è¶…å–åŒº(<20)');
                if (j < 0) {
                    details.push('Jçº¿æç«¯è¶…å–(<0)ï¼Œå…³æ³¨åå¼¹');
                    signal = 'bullish';
                    confidence += 0.3;
                } else {
                    details.push('Jçº¿æœªæç«¯ï¼Œå…³æ³¨åå¼¹ä¿¡å·');
                }
            } else {
                details.push('Kã€Dçº¿åœ¨æ­£å¸¸åŒºé—´(20-80)');
            }
            
            // 2. é‡‘å‰æ­»å‰åˆ¤æ–­
            if (k > d && prevK <= prevD) {
                details.push('Kçº¿ä¸Šç©¿Dçº¿å½¢æˆé‡‘å‰');
                if (j > 0) {
                    details.push('Jçº¿é…åˆå‘ä¸Šï¼Œä¹°å…¥ä¿¡å·è¾ƒå¼º');
                    signal = 'bullish';
                    confidence += 0.4;
                } else {
                    details.push('Jçº¿æœªé…åˆï¼Œä¿¡å·è¾ƒå¼±');
                    confidence += 0.2;
                }
            } else if (k < d && prevK >= prevD) {
                details.push('Kçº¿ä¸‹ç©¿Dçº¿å½¢æˆæ­»å‰');
                if (j < 0) {
                    details.push('Jçº¿é…åˆå‘ä¸‹ï¼Œå–å‡ºä¿¡å·è¾ƒå¼º');
                    signal = 'bearish';
                    confidence += 0.4;
                } else {
                    details.push('Jçº¿æœªé…åˆï¼Œä¿¡å·è¾ƒå¼±');
                    confidence += 0.2;
                }
            }
            
            // 3. Jçº¿åŠ é€Ÿåº¦åˆ†æ
            const jChange = j - prevJ;
            if (Math.abs(jChange) > 10) {
                if (jChange > 0) {
                    details.push('Jçº¿åŠ é€Ÿå‘ä¸Šï¼ŒåŠ¨é‡å¢å¼º');
                    if (signal === 'bullish') confidence += 0.2;
                } else {
                    details.push('Jçº¿åŠ é€Ÿå‘ä¸‹ï¼ŒåŠ¨é‡å‡å¼±');
                    if (signal === 'bearish') confidence += 0.2;
                }
            } else {
                details.push('Jçº¿å˜åŒ–å¹³ç¼“ï¼ŒåŠ¨é‡ç¨³å®š');
            }
            
            // 4. è¶‹åŠ¿å¼ºåº¦åˆ¤æ–­
            const kdTrend = k - d;
            const prevKdTrend = prevK - prevD;
            if (Math.abs(kdTrend) > Math.abs(prevKdTrend)) {
                details.push('Kã€Dçº¿åˆ†ç¦»åº¦å¢åŠ ï¼Œè¶‹åŠ¿åŠ å¼º');
                confidence += 0.1;
            } else if (Math.abs(kdTrend) < Math.abs(prevKdTrend)) {
                details.push('Kã€Dçº¿æ”¶æ•›ï¼Œè¶‹åŠ¿å‡å¼±');
                confidence -= 0.1;
            }
            
            // 5. ç»¼åˆåˆ¤æ–­
            confidence = Math.min(confidence, 1.0);
            
            if (confidence > 0.6) {
                if (signal === 'bullish') {
                    analysis = 'KDJå‘¨çº¿æ˜¾ç¤ºå¼ºåŠ¿ä¹°å…¥ä¿¡å·ï¼Œå»ºè®®å…³æ³¨';
                } else if (signal === 'bearish') {
                    analysis = 'KDJå‘¨çº¿æ˜¾ç¤ºå¼ºåŠ¿å–å‡ºä¿¡å·ï¼Œå»ºè®®è°¨æ…';
                }
            } else if (confidence > 0.3) {
                if (signal === 'bullish') {
                    analysis = 'KDJå‘¨çº¿æ˜¾ç¤ºä¹°å…¥ä¿¡å·ï¼Œå¯é€‚åº¦å…³æ³¨';
                } else if (signal === 'bearish') {
                    analysis = 'KDJå‘¨çº¿æ˜¾ç¤ºå–å‡ºä¿¡å·ï¼Œå»ºè®®è§‚æœ›';
                }
            } else {
                analysis = 'KDJå‘¨çº¿ä¿¡å·ä¸æ˜ç¡®ï¼Œå»ºè®®ç»§ç»­è§‚å¯Ÿ';
                signal = 'neutral';
            }
            
            return {
                signal: signal,
                confidence: confidence,
                analysis: analysis,
                details: details,
                values: {
                    k: k.toFixed(2),
                    d: d.toFixed(2),
                    j: j.toFixed(2)
                }
            };
        }
        
        // å¤šå‘¨æœŸKDJç»¼åˆåˆ†æ
        function analyzeMultiPeriodKDJ(fund) {
            const dailyKDJ = fund.kdj || [];
            const weeklyKDJ = fund.weeklyKDJ || [];
            const monthlyKDJ = fund.monthlyKDJ || [];
            
            const signals = {
                daily: dailyKDJ.length > 0 ? analyzeKDJSignal(dailyKDJ) : null,
                weekly: weeklyKDJ.length > 0 ? analyzeKDJMomentum(weeklyKDJ) : null,
                monthly: monthlyKDJ.length > 0 ? analyzeKDJSignal(monthlyKDJ) : null
            };
            
            // ç»¼åˆåˆ¤æ–­
            let overallSignal = 'neutral';
            let confidence = 0;
            let reasons = [];
            
            // æœˆçº¿å®šæ–¹å‘
            if (signals.monthly) {
                if (signals.monthly.signal === 'bullish') {
                    confidence += 0.4;
                    reasons.push('æœˆçº¿çœ‹å¤š');
                } else if (signals.monthly.signal === 'bearish') {
                    confidence -= 0.4;
                    reasons.push('æœˆçº¿çœ‹ç©º');
                }
            }
            
            // å‘¨çº¿ç¡®è®¤è¶‹åŠ¿
            if (signals.weekly) {
                if (signals.weekly.signal === 'bullish') {
                    confidence += 0.3;
                    reasons.push('å‘¨çº¿ç¡®è®¤');
                } else if (signals.weekly.signal === 'bearish') {
                    confidence -= 0.3;
                    reasons.push('å‘¨çº¿ç¡®è®¤');
                }
            }
            
            // æ—¥çº¿æ‹©æ—¶
            if (signals.daily) {
                if (signals.daily.signal === 'bullish') {
                    confidence += 0.3;
                    reasons.push('æ—¥çº¿ä¹°å…¥');
                } else if (signals.daily.signal === 'bearish') {
                    confidence -= 0.3;
                    reasons.push('æ—¥çº¿å–å‡º');
                }
            }
            
            if (confidence > 0.5) {
                overallSignal = 'bullish';
            } else if (confidence < -0.5) {
                overallSignal = 'bearish';
            } else {
                overallSignal = 'neutral';
            }
            
            return {
                signal: overallSignal,
                confidence: Math.abs(confidence),
                reasons: reasons,
                details: signals
            };
        }
        
        // ç”Ÿæˆæ¨¡æ‹ŸåŸºé‡‘æ•°æ®ï¼ˆåŒ…å«é«˜ä½ä»·ç”¨äºKDJè®¡ç®—ï¼‰
        function generateMockFunds() {
            const mockFunds = [];
            const allFundCodes = Object.values(fundCategories).flat().slice(0, 20); // é™åˆ¶æ•°é‡
            
            // è·å–ä»Šå¤©çš„æ—¥æœŸä½œä¸ºåˆ†ç•Œç‚¹
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            allFundCodes.forEach(fundInfo => {
                const mockData = [];
                const baseNav = 1.0 + Math.random() * 2; // 1.0-3.0ä¹‹é—´çš„å‡€å€¼
                let currentNav = baseNav;
                
                // ç”Ÿæˆ365å¤©çš„æ¨¡æ‹Ÿæ•°æ®ï¼ˆç”¨äºå¤šå‘¨æœŸKDJè®¡ç®—ï¼Œç¡®ä¿æœ‰52å‘¨æ•°æ®ï¼‰
                for (let i = 0; i < 365; i++) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    const dateStr = date.toISOString().split('T')[0];
                    
                    // ç”Ÿæˆæ›´çœŸå®çš„ä»·æ ¼æ³¢åŠ¨
                    const volatility = 0.02 + Math.random() * 0.03; // 2%-5%çš„æ³¢åŠ¨ç‡
                    const trend = (Math.random() - 0.5) * 0.001; // è½»å¾®è¶‹åŠ¿
                    const change = (Math.random() - 0.5) * volatility + trend;
                    
                    const newNav = currentNav * (1 + change);
                    const high = Math.max(currentNav, newNav) * (1 + Math.random() * 0.01);
                    const low = Math.min(currentNav, newNav) * (1 - Math.random() * 0.01);
                    
                    // åŸºäºå®é™…æ—¥æœŸåˆ¤æ–­æ•°æ®æºï¼šä»Šå¤©åŠä»¥åä¸ºçœŸå®æ•°æ®ï¼Œå†å²ä¸ºæ¨¡æ‹Ÿæ•°æ®
                    const isRealData = dateStr >= todayStr;
                    
                    mockData.push({
                        date: dateStr,
                        nav: newNav.toFixed(4),
                        close: parseFloat(newNav.toFixed(4)),
                        high: parseFloat(high.toFixed(4)),
                        low: parseFloat(low.toFixed(4)),
                        change: (change * 100).toFixed(2),
                        source: isRealData ? 'real' : 'mock'
                    });
                    
                    currentNav = newNav;
                }
                
                // ç”Ÿæˆå¤šå‘¨æœŸæ•°æ®
                const dailyData = mockData.reverse(); // åè½¬æ•°æ®ï¼Œè®©æœ€æ–°çš„åœ¨å‰é¢
                const weeklyData = generateWeeklyData(dailyData);
                const monthlyData = generateMonthlyData(dailyData);
                
                // è®¡ç®—å¤šå‘¨æœŸKDJæŒ‡æ ‡
                const dailyKDJ = calculateKDJ(dailyData);
                const weeklyKDJ = calculateKDJ(weeklyData);
                const monthlyKDJ = calculateKDJ(monthlyData);
                
                // è®¡ç®—çœŸå®æ•°æ®ç»Ÿè®¡
                const realDataCount = dailyData.filter(d => d.source === 'real').length;
                const mockDataCount = dailyData.filter(d => d.source === 'mock').length;
                
                mockFunds.push({
                    code: fundInfo.code,
                    name: fundInfo.name,
                    data: dailyData.reverse(), // å†æ¬¡åè½¬ï¼Œä¿æŒæ—¶é—´é¡ºåº
                    kdj: dailyKDJ,
                    weeklyKDJ: weeklyKDJ,
                    monthlyKDJ: monthlyKDJ,
                    stats: {
                        real: realDataCount,
                        mock: mockDataCount,
                        total: dailyData.length
                    }
                });
            });
            
            return mockFunds;
        }
        
        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(funds) {
            const totalFunds = funds.length;
            const realDataCount = funds.filter(fund => fund.data && fund.data.length > 0).length;
            const realDataRatio = totalFunds > 0 ? ((realDataCount / totalFunds) * 100).toFixed(1) : 0;
            
            const realDays = funds.map(fund => fund.stats?.real || 0);
            const avgRealDays = realDays.length > 0 ? (realDays.reduce((a, b) => a + b, 0) / realDays.length).toFixed(1) : 0;
            const maxRealDays = realDays.length > 0 ? Math.max(...realDays) : 0;
            
            document.getElementById('totalFunds').textContent = totalFunds;
            document.getElementById('realDataRatio').textContent = `${realDataRatio}%`;
            document.getElementById('avgRealDays').textContent = avgRealDays;
            document.getElementById('maxRealDays').textContent = maxRealDays;
        }
        
        // æ¸²æŸ“åŸºé‡‘å¡ç‰‡ - ä¸“æ³¨äºKDJå‘¨çº¿åˆ†æ
        function renderFundCard(fund) {
            const latest = fund.data && fund.data.length > 0 ? fund.data[0] : null;
            const changeClass = latest ? getChangeClass(latest.change) : '';
            const sourceClass = latest && latest.source === 'real' ? 'real' : 'mock';
            const sourceText = latest && latest.source === 'real' ? 'çœŸå®æ•°æ®' : 'æ¨¡æ‹Ÿæ•°æ®';
            const fundType = getFundType(fund.code);
            
            // KDJå‘¨çº¿åˆ†æ
            const weeklyAnalysis = fund.weeklyKDJ && fund.weeklyKDJ.length > 0 ? analyzeKDJMomentum(fund.weeklyKDJ) : null;
            
            return `
                <div class="fund-card" data-category="${fundType}">
                    <!-- å¤´éƒ¨åŒºåŸŸ -->
                    <div class="fund-header">
                        <div>
                            <div class="fund-name">${fund.name}</div>
                            <div class="fund-code">ä»£ç : ${fund.code}</div>
                        </div>
                        <div class="fund-type-badge ${fundType}">${fundType}</div>
                    </div>
                    
                    <!-- å…³é”®æ•°æ® -->
                    <div class="fund-stats">
                        <div class="stat">
                            <div class="stat-value ${changeClass}">
                                ${latest ? formatNumber(latest.nav) : '-'}
                            </div>
                            <div class="stat-label">å‡€å€¼</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value ${changeClass}">
                                ${latest ? formatPercent(latest.change) : '-'}
                            </div>
                            <div class="stat-label">æ¶¨è·Œå¹…</div>
                        </div>
                    </div>
                    
                    <!-- KDJå‘¨çº¿åˆ†æåŒºåŸŸ -->
                    <div class="kdj-analysis-section">
                        ${fund.weeklyKDJ && fund.weeklyKDJ.length > 0 ? `
                            <!-- KDJå‘¨çº¿èµ°åŠ¿å›¾ -->
                            <div class="kdj-chart-container">
                                <div class="chart-title">KDJå‘¨çº¿èµ°åŠ¿å›¾</div>
                                ${generateKDJWeeklyChart(fund.weeklyKDJ, '100%', 100)}
                            </div>
                            
                            <!-- KDJæ•°å€¼æ˜¾ç¤º -->
                            <div class="kdj-values">
                                <div class="kdj-value-item">
                                    <div class="kdj-value-label">Kçº¿</div>
                                    <div class="kdj-value-number k-line">${weeklyAnalysis.values.k}</div>
                                </div>
                                <div class="kdj-value-item">
                                    <div class="kdj-value-label">Dçº¿</div>
                                    <div class="kdj-value-number d-line">${weeklyAnalysis.values.d}</div>
                                </div>
                                <div class="kdj-value-item">
                                    <div class="kdj-value-label">Jçº¿</div>
                                    <div class="kdj-value-number j-line">${weeklyAnalysis.values.j}</div>
                                </div>
                            </div>
                            
                            <!-- ç»¼åˆåˆ†æ -->
                            <div class="kdj-analysis">
                                <div class="analysis-title">å‘¨çº¿KDJåŠ¨é‡åˆ†æ</div>
                                <div class="analysis-content">
                                    <div class="analysis-signal ${weeklyAnalysis.signal}">
                                        ${weeklyAnalysis.analysis}
                                    </div>
                                    <div class="analysis-details">
                                        ${weeklyAnalysis.details.map(detail => `<div class="detail-item">â€¢ ${detail}</div>`).join('')}
                                    </div>
                                </div>
                            </div>
                        ` : `
                            <div class="no-weekly-data">å‘¨çº¿æ•°æ®ä¸è¶³ï¼Œæ— æ³•è¿›è¡ŒKDJåˆ†æ</div>
                        `}
                    </div>
                    
                    <!-- æ•°æ®æºä¿¡æ¯ -->
                    <div class="data-source">
                        <div class="data-source-indicator ${sourceClass}"></div>
                        <span>${sourceText}</span>
                        <span>${latest ? formatDate(latest.date) : ''}</span>
                    </div>
                </div>
            `;
        }
        
        // æ¸²æŸ“åŸºé‡‘åˆ—è¡¨
        function renderFundList(funds) {
            const container = document.getElementById('fundContainer');
            
            if (!funds || funds.length === 0) {
                container.innerHTML = '<div class="error">æš‚æ— åŸºé‡‘æ•°æ®</div>';
                return;
            }
            
            const filteredFunds = currentCategory === 'all' 
                ? funds 
                : funds.filter(fund => getFundType(fund.code) === currentCategory);
            
            const html = filteredFunds.map(fund => renderFundCard(fund)).join('');
            container.innerHTML = html;
            
            // å»¶è¿Ÿåˆå§‹åŒ–å›¾è¡¨äº¤äº’ï¼Œç¡®ä¿DOMå®Œå…¨æ¸²æŸ“
            setTimeout(() => {
                initializeChartInteractions();
            }, 100);
        }
        
        // åˆå§‹åŒ–å›¾è¡¨äº¤äº’åŠŸèƒ½
        function initializeChartInteractions() {
            console.log('å¼€å§‹åˆå§‹åŒ–å›¾è¡¨äº¤äº’åŠŸèƒ½...');
            const areas = document.querySelectorAll('.interaction-area');
            console.log(`æ‰¾åˆ° ${areas.length} ä¸ªäº¤äº’åŒºåŸŸ`);
            
            // ä¸ºæ‰€æœ‰äº¤äº’åŒºåŸŸæ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            areas.forEach((area, index) => {
                const chartId = area.getAttribute('data-chart-id');
                const weeklyDataStr = area.getAttribute('data-weekly-data');
                const tooltip = document.getElementById(`tooltip-${chartId}`);
                const svg = document.getElementById(chartId);
                
                console.log(`å¤„ç†åŒºåŸŸ ${index + 1}:`, { chartId, hasTooltip: !!tooltip, hasSvg: !!svg, hasData: !!weeklyDataStr });
                
                if (!tooltip || !svg) {
                    console.warn(`åŒºåŸŸ ${index + 1} ç¼ºå°‘å¿…è¦å…ƒç´ :`, { tooltip: !!tooltip, svg: !!svg });
                    return;
                }
                
                let weeklyData;
                try {
                    weeklyData = JSON.parse(weeklyDataStr);
                    console.log(`åŒºåŸŸ ${index + 1} æ•°æ®è§£ææˆåŠŸï¼Œæ•°æ®ç‚¹æ•°é‡:`, weeklyData.length);
                } catch (e) {
                    console.error(`åŒºåŸŸ ${index + 1} æ•°æ®è§£æå¤±è´¥:`, e);
                    return;
                }
                
                // é¼ æ ‡ç§»åŠ¨äº‹ä»¶
                area.addEventListener('mousemove', (e) => {
                    const rect = svg.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // è®¡ç®—å¯¹åº”çš„æ•°æ®ç‚¹ - ä½¿ç”¨ä¸å›¾è¡¨ç›¸åŒçš„padding
                    const padding = { top: 15, right: 30, bottom: 25, left: 30 };
                    const chartWidth = rect.width - padding.left - padding.right;
                    const chartHeight = rect.height - padding.top - padding.bottom;
                    
                    const relativeX = x - padding.left;
                    const dataIndex = Math.round((relativeX / chartWidth) * (weeklyData.length - 1));
                    
                    console.log(`é¼ æ ‡ç§»åŠ¨: x=${x}, relativeX=${relativeX}, dataIndex=${dataIndex}, chartWidth=${chartWidth}`);
                    
                    if (dataIndex >= 0 && dataIndex < weeklyData.length) {
                        const data = weeklyData[dataIndex];
                        console.log(`æ˜¾ç¤ºtooltip:`, data);
                        showTooltip(tooltip, data, e.clientX, e.clientY);
                    }
                });
                
                // é¼ æ ‡ç¦»å¼€äº‹ä»¶
                area.addEventListener('mouseleave', () => {
                    hideTooltip(tooltip);
                });
                
                // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
                area.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    const rect = svg.getBoundingClientRect();
                    const x = touch.clientX - rect.left;
                    const y = touch.clientY - rect.top;
                    
                    const padding = { top: 15, right: 30, bottom: 25, left: 30 };
                    const chartWidth = rect.width - padding.left - padding.right;
                    const relativeX = x - padding.left;
                    const dataIndex = Math.round((relativeX / chartWidth) * (weeklyData.length - 1));
                    
                    if (dataIndex >= 0 && dataIndex < weeklyData.length) {
                        const data = weeklyData[dataIndex];
                        showTooltip(tooltip, data, touch.clientX, touch.clientY);
                    }
                });
                
                area.addEventListener('touchend', () => {
                    hideTooltip(tooltip);
                });
            });
        }
        
        // æ˜¾ç¤ºtooltip
        function showTooltip(tooltip, data, x, y) {
            console.log('æ˜¾ç¤ºtooltip:', { data, x, y });
            
            const date = new Date(data.date);
            const dateStr = `${date.getFullYear()}/${date.getMonth() + 1}/${date.getDate()}`;
            
            // æ›´æ–°tooltipå†…å®¹
            const dateEl = tooltip.querySelector('.tooltip-date');
            const kEl = tooltip.querySelector('.k-value');
            const dEl = tooltip.querySelector('.d-value');
            const jEl = tooltip.querySelector('.j-value');
            
            if (dateEl) dateEl.textContent = dateStr;
            if (kEl) kEl.textContent = data.k.toFixed(2);
            if (dEl) dEl.textContent = data.d.toFixed(2);
            if (jEl) jEl.textContent = data.j.toFixed(2);
            
            // å®šä½tooltip
            tooltip.style.left = (x + 10) + 'px';
            tooltip.style.top = (y - 10) + 'px';
            tooltip.classList.add('show');
            
            console.log('tooltipå·²æ˜¾ç¤º');
        }
        
        // éšè—tooltip
        function hideTooltip(tooltip) {
            tooltip.classList.remove('show');
        }
        
        // ç­›é€‰å™¨äº‹ä»¶
        function setupFilterTabs() {
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentCategory = tab.dataset.category;
                    renderFundList(allFunds);
                });
            });
        }
        
        // æ··åˆæ•°æ®åŠ è½½ï¼ˆçœŸå®æ•°æ® + æ¨¡æ‹Ÿæ•°æ®ï¼‰
        async function loadData() {
            try {
                console.log('å¼€å§‹åŠ è½½åŸºé‡‘æ•°æ®...');
                
                // å…ˆå°è¯•åŠ è½½æœ¬åœ°å­˜å‚¨çš„æ•°æ®
                let storedData = loadFundData();
                let funds = [];
                
                if (storedData) {
                    console.log('ä½¿ç”¨æœ¬åœ°å­˜å‚¨çš„æ•°æ®');
                    funds = storedData;
                } else {
                    console.log('æœ¬åœ°æ•°æ®ä¸å¯ç”¨ï¼Œå¼€å§‹æ”¶é›†çœŸå®æ•°æ®...');
                    
                    // æ”¶é›†çœŸå®æ•°æ®
                    const realData = await collectAllFundsData();
                    
                    if (realData.length > 0) {
                        // ä¿å­˜çœŸå®æ•°æ®
                        saveFundData(realData);
                        funds = realData;
                    } else {
                        console.log('çœŸå®æ•°æ®æ”¶é›†å¤±è´¥ï¼Œä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®');
                        funds = generateMockFunds();
                    }
                }
                
                // å¦‚æœçœŸå®æ•°æ®ä¸è¶³ï¼Œè¡¥å……æ¨¡æ‹Ÿæ•°æ®
                if (funds.length < 10) {
                    console.log('çœŸå®æ•°æ®ä¸è¶³ï¼Œè¡¥å……æ¨¡æ‹Ÿæ•°æ®');
                    const mockFunds = generateMockFunds();
                    funds = [...funds, ...mockFunds.slice(funds.length)];
                }
                
                allFunds = funds;
                updateStats(funds);
                renderFundList(funds);
                
                // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
                document.getElementById('lastUpdate').textContent = `æ›´æ–°æ—¶é—´: ${new Date().toLocaleTimeString('zh-CN')}`;
                
                // æ˜¾ç¤ºæ•°æ®æºä¿¡æ¯
                const realCount = funds.filter(f => f.source === 'real').length;
                const mockCount = funds.filter(f => f.source === 'mock').length;
                
                document.getElementById('fundContainer').innerHTML = `
                    <div class="success">
                        <h4>âœ… æ•°æ®åŠ è½½å®Œæˆ</h4>
                        <p>çœŸå®æ•°æ®: ${realCount} ä¸ªåŸºé‡‘ | æ¨¡æ‹Ÿæ•°æ®: ${mockCount} ä¸ªåŸºé‡‘</p>
                        <p>æ•°æ®æ¥æº: å¤©å¤©åŸºé‡‘ + æœ¬åœ°æ¨¡æ‹Ÿ</p>
                    </div>
                    ${funds.map(fund => renderFundCard(fund)).join('')}
                `;
                
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                
                // é™çº§åˆ°çº¯æ¨¡æ‹Ÿæ•°æ®
                console.log('é™çº§åˆ°çº¯æ¨¡æ‹Ÿæ•°æ®æ¨¡å¼');
                const mockFunds = generateMockFunds();
                allFunds = mockFunds;
                updateStats(mockFunds);
                renderFundList(mockFunds);
                
                document.getElementById('fundContainer').innerHTML = `
                    <div class="error">
                        <h4>âš ï¸ ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®</h4>
                        <p>çœŸå®æ•°æ®è·å–å¤±è´¥ï¼Œæ­£åœ¨æ˜¾ç¤ºæ¨¡æ‹Ÿæ•°æ®</p>
                        <p>é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                    </div>
                    ${mockFunds.map(fund => renderFundCard(fund)).join('')}
                `;
            }
        }
        
        // æ¯æ—¥æ•°æ®æ›´æ–°æ£€æŸ¥
        function checkDailyUpdate() {
            const now = new Date();
            const lastUpdate = localStorage.getItem('last_daily_update');
            
            if (!lastUpdate) {
                // é¦–æ¬¡è¿è¡Œï¼Œè®¾ç½®ä»Šå¤©ä¸ºæ›´æ–°æ—¥æœŸ
                localStorage.setItem('last_daily_update', now.toDateString());
                return true;
            }
            
            const lastUpdateDate = new Date(lastUpdate);
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const lastUpdateDay = new Date(lastUpdateDate.getFullYear(), lastUpdateDate.getMonth(), lastUpdateDate.getDate());
            
            // å¦‚æœä»Šå¤©è¿˜æ²¡æœ‰æ›´æ–°è¿‡ï¼Œè¿”å›true
            return today > lastUpdateDay;
        }
        
        // æ‰§è¡Œæ¯æ—¥æ›´æ–°
        async function performDailyUpdate() {
            if (checkDailyUpdate()) {
                console.log('æ‰§è¡Œæ¯æ—¥æ•°æ®æ›´æ–°...');
                
                try {
                    // æ¸…é™¤æ—§æ•°æ®
                    localStorage.removeItem('fund_monitoring_data');
                    
                    // æ”¶é›†æ–°çš„çœŸå®æ•°æ®
                    const realData = await collectAllFundsData();
                    
                    if (realData.length > 0) {
                        saveFundData(realData);
                        localStorage.setItem('last_daily_update', new Date().toDateString());
                        console.log('æ¯æ—¥æ•°æ®æ›´æ–°å®Œæˆ');
                        
                        // é‡æ–°åŠ è½½é¡µé¢æ•°æ®
                        await loadData();
                    }
                } catch (error) {
                    console.warn('æ¯æ—¥æ›´æ–°å¤±è´¥:', error.message);
                }
            }
        }
        
        // ç»Ÿè®¡å­—æ®µæ˜¾ç¤ºæ§åˆ¶
        function initStatsToggle() {
            const toggle = document.getElementById('statsToggle');
            const statsGrid = document.querySelector('.stats-grid');
            const avgRealDaysCard = document.getElementById('avgRealDaysCard');
            const maxRealDaysCard = document.getElementById('maxRealDaysCard');
            
            function updateStatsDisplay() {
                const isChecked = toggle.checked;
                
                if (isChecked) {
                    // æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡
                    avgRealDaysCard.classList.remove('hidden');
                    maxRealDaysCard.classList.remove('hidden');
                    statsGrid.classList.remove('adaptive-2-cols');
                } else {
                    // éšè—è¯¦ç»†ç»Ÿè®¡
                    avgRealDaysCard.classList.add('hidden');
                    maxRealDaysCard.classList.add('hidden');
                    statsGrid.classList.add('adaptive-2-cols');
                }
            }
            
            // åˆå§‹åŒ–çŠ¶æ€
            updateStatsDisplay();
            
            // ç›‘å¬å¼€å…³å˜åŒ–
            toggle.addEventListener('change', updateStatsDisplay);
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            setupFilterTabs();
            initStatsToggle();
            loadData();
            
            // æ¯5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°æ•°æ®
            setInterval(loadData, 5 * 60 * 1000);
            
            // æ¯30åˆ†é’Ÿæ£€æŸ¥æ˜¯å¦éœ€è¦æ¯æ—¥æ›´æ–°
            setInterval(performDailyUpdate, 30 * 60 * 1000);
            
            // é¡µé¢å¯è§æ—¶æ£€æŸ¥æ›´æ–°
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) {
                    performDailyUpdate();
                }
            });
        });
    </script>
</body>
</html>
